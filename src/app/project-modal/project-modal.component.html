<div class="modern-modal p-3">
  <div class="modal-header border-0">
    <h2 class="modal-title fw-bold gradient-text">{{ project.nom }}</h2>
    <button class="btn-close" (click)="activeModal.dismissAll()"></button>
  </div>

  <div class="modal-body">
    <!-- AFFICHAGE POUR LES JEUX -->
    <div *ngIf="isGame()" class="sandbox-modal">
      <!-- HEADER -->
      <div class="sandbox-header">
        <div class="sandbox-tabs">
          <button
            class="tab-btn"
            [class.active]="activeTab === 'preview'"
            (click)="activeTab = 'preview'"
          >
            Preview
          </button>
          <button
            class="tab-btn"
            [class.active]="activeTab === 'code'"
            (click)="activeTab = 'code'"
          >
            Code
          </button>
        </div>
      </div>
      <!-- BODY -->
      <div class="sandbox-body">
        <div
          class="sandbox-panel preview-panel"
          [class.hidden]="activeTab === 'code'"
        >
          <iframe
            [src]="getGameUrl() | safe:'resourceUrl'"
            class="sandbox-iframe"
            title="Preview - {{ project.nom }}"
          ></iframe>
        </div>
        <!-- CODE PANEL -->
        <div
          class="sandbox-panel code-panel"
          [class.hidden]="activeTab === 'preview'"
        >
          <!-- FILE EXPLORER -->
          <aside class="file-explorer">
            <ng-template #recursiveTree let-nodes let-level="level">
              <ng-container *ngFor="let node of nodes">
                <div
                  *ngIf="node.type === 'folder'"
                  class="tree-item folder"
                  [style.paddingLeft.px]="level * 14"
                >
                  <div
                    class="folder-label"
                    (click)="toggleFolder(node)"
                  >
                    <span class="iconify" [attr.data-icon]="node.expanded ? 'mdi:chevron-down' : 'mdi:chevron-right'" data-inline="false" style="color:#888;"></span>
                    <!-- icÃ´ne dossier -->
                    <span class="iconify" [attr.data-icon]="getFileIcon(node.name, node.type === 'folder').icon" data-inline="false"></span>
                    <span>{{ node.name }}</span>
                  </div>

                  <div *ngIf="node.expanded">
                    <ng-container
                      *ngTemplateOutlet="recursiveTree; context: { $implicit: node.children, level: level + 1 }"
                    ></ng-container>
                  </div>
                </div>
                <div
                  *ngIf="node.type === 'file'"
                  class="tree-item file"
                  [class.active]="node === selectedFile"
                  [style.paddingLeft.px]="level * 14 + 22"
                  (click)="selectFile(node)"
                >
                  <span class="iconify" [attr.data-icon]="getFileIcon(node.name).icon" data-inline="false"></span>
                  <span>{{ node.name }}</span>
                </div>
              </ng-container>
            </ng-template>

            <ng-container
              *ngTemplateOutlet="recursiveTree; context: { $implicit: fileTree, level: 0 }"
            ></ng-container>
          </aside>

          <!-- CODE VIEW -->
          <section class="editor-container">
            <div class="line-numbers">
              <span *ngFor="let _ of fileContent.split('\n'); let i = index">
                {{ i + 1 }}
              </span>
            </div>
            <div class="code-viewer flex-fill ps-3">
              <pre><code #codeBlock class="language-ts">{{ fileContent }}</code></pre>
            </div>
          </section>
        </div>
      </div>
    </div>

    <!-- AFFICHAGE POUR LES PROJETS CLASSIQUES -->
    <div *ngIf="!isGame()" class="standard-project-content">
      <div class="carousel-container rounded-4 overflow-hidden shadow-lg mb-4">
        <ngb-carousel [interval]="6000">
          <ng-template ngbSlide *ngFor="let image of project.image">
            <img
              [src]="image"
              alt="image de {{ project.nom }}"
              class="d-block w-100 project-img"
            />
          </ng-template>
        </ngb-carousel>
      </div>

      <div class="project-content">
        <h3 class="section-title">Description</h3>
        <p class="project-description">{{ project.description }}</p>

        <div class="project-links my-3">
          <span>Voir le projet sur {{ project.where }} :</span>
          <a
            [href]="project.projectLink"
            target="_blank"
            class="btn btn-gradient ms-2"
          >
            Ouvrir
          </a>
        </div>

        <hr class="divider" />

        <div class="tags-container mt-3 d-flex flex-wrap justify-content-start">
          <span
            *ngFor="let tag of project.tags"
            class="tag-pill"
            [style.borderColor]="tag.color"
          >
            {{ tag }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>